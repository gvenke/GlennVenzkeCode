
@{
    ViewBag.Title = "Weather";
}

<h2>Weather</h2>

<div class="container">
    <div>weather for <span id="zip"></span></div>
    <input type="text" id="zipCode" />
    <input type="button" id="sendZip" value="Send" />
    <div id="weather" style="visibility:hidden;">
        updated at <span id="updated"></span><br/>
        description: <span id="description"></span><br />
        current tempurature: <span id="temp"></span><br />
        low temperature: <span id="lowTemp"></span><br />
        high temperature: <span id="highTemp"></span><br />
        air pressure: <span id="airPressure"></span><br />
        humidity: <span id="humidity"></span><br />
    </div>

    @section scripts {
        <script src="~/Scripts/jquery.signalR-2.4.1.js"></script>
        <!--Reference the autogenerated SignalR hub script. -->
        <script src="~/signalr/hubs"></script>
        <script>
            $(function () {

                var weatherHub = $.connection.weatherReportingHub;

                function init() {
                    weatherHub.state.zipCode = $('#zipCode').val();
                    weatherHub.server.init().done(function (weatherData) {
                        renderWeather(weatherData);
                    });
                }

                function renderWeather(weatherData) {
                    var d = new Date();
                    $('#zip').text(weatherHub.state.zipCode);
                    $('#updated').text(d.toLocaleString());
                    $('#description').text(weatherData.Description);
                    $('#temp').text(weatherData.CurrentTemperature);
                    $('#lowTemp').text(weatherData.LowTemperature);
                    $('#highTemp').text(weatherData.HighTemperature);
                    $('#airPressure').text(weatherData.AirPressure);
                    $('#humidity').text(weatherData.Humidity);
                    $('#weather').css('cssText', 'display: block');
                }

                weatherHub.client.updateWeatherData = function (weatherData) {
                    renderWeather(weatherData);
                }

                $.connection.hub.start().done(function () {
                    $('#sendZip').click(function () {

                        init();
                    });
                });
            });

        </script>
    }
</div>

